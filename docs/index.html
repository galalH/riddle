<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="The package wraps functions to work with the RIDL API
    ridl.unhcr.org from R.">
<title>An API wrapper to interact with the UNHCR RIDL Platform • riddle</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="deps/Lato-0.4.6/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.6/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An API wrapper to interact with the UNHCR RIDL Platform">
<meta property="og:description" content="The package wraps functions to work with the RIDL API
    ridl.unhcr.org from R.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">riddle</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/package-functions.html">Package Functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/edouard-legoupil/riddle/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="riddle">riddle<a class="anchor" aria-label="anchor" href="#riddle"></a>
</h1></div>
<p>This is a minimal package for programatically interacting with the <a href="https://ridl.unhcr.org" class="external-link">UNHCR Raw Internal Data Library (RIDL)</a>. The main purpose served by this package is to make the <a href="https://docs.ckan.org/en/2.9/api/index.html" class="external-link">RIDL API documentation</a> more readily accessible within an R ecosystem for better automation.</p>
<div class="section level2">
<h2 id="install-and-configure-authentication-token">Install and configure authentication token<a class="anchor" aria-label="anchor" href="#install-and-configure-authentication-token"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pak"</span><span class="op">)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="http://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"edouard-legoupil/riddle"</span><span class="op">)</span> </span></code></pre></div>
<p>The <code>riddle</code> package requires you to add your <strong>API token</strong> and store it for further use. The easiest way to do that is to store your API token in your <code>.Renviron</code> file which is automatically read by R on startup.</p>
<p>You can retrieve your <code>API TOKEN</code> in your <a href="https://ridl.unhcr.org/user/" class="external-link">user page</a>.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/Edouard-Legoupil/riddle/main/inst/token.png" alt=""><p class="caption">api_token_img</p>
</div>
<p>To use the package, you’ll need to store your RIDL API token in the <code>RIDL_API_TOKEN</code> environment variable. The easiest way to do that is by calling <code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code> and adding the line <code>RIDL_API_TOKEN=xxxxx</code> to the file before saving and restarting your R session.</p>
<p>The package works with both the production and <a href="https://ridl-uat.unhcr.org" class="external-link">UAT instances of RIDL</a> (aka “User Acceptance Testing”). To use the UAT version, add the corresponding TOKEN within your <code>.Renviron</code> file: <code>RIDL_UAT_API_TOKEN=xxxxx</code>. To use the UAT version, run <code>Sys.setenv(USE_UAT=1)</code> before calling any functions from the package. To go back to the production instance, call <code>Sys.unsetenv("USE_UAT")</code>.</p>
</div>
<div class="section level2">
<h2 id="a-quick-intro-to-ridl-concepts">A quick intro to RIDL concepts<a class="anchor" aria-label="anchor" href="#a-quick-intro-to-ridl-concepts"></a>
</h2>
<p>In order to easily use the <code>ridlle</code> package, it’s important to understand some 3 main concepts of this platform. RIDL is based on <a href="https://ckan.org/" class="external-link">CKAN</a> and the documentation is available <a href="https://im.unhcr.org/ridl" class="external-link">here</a> for more details.</p>
<div class="section level3">
<h3 id="container">
<code>Container</code><a class="anchor" aria-label="anchor" href="#container"></a>
</h3>
<p>A <code>container</code> is a placeholder where we can share data on <code>RIDL</code>. A <code>container</code> can hold zero or multiple <code>datasets</code>. As a convention all operations datasets are grouped together within a container but an operation container can also include multiple specific containers. Container are documented within the dataset metadata through the variable <code>owner_org</code></p>
<p>Container URL are typically formatted as:</p>
<blockquote>
<p><a href="https://ridl.unhcr.org/data-container/%60__name_of_country__" class="external-link uri">https://ridl.unhcr.org/data-container/`__name_of_country__</a>`</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="dataset">
<code>Dataset</code><a class="anchor" aria-label="anchor" href="#dataset"></a>
</h3>
<p>A <code>dataset</code> is a placeholder where we can share a series of data and documentation files (called <code>resources</code> - see below), eac of them linked to a data project. Each dataset is described with some metadata (using the <a href="https://ddialliance.org/" class="external-link">data documentation initiative (DDI) format</a>) that gives enough context on the project and information to properly store the data files and use them.</p>
<p>Dataset URL are typically formatted as:</p>
<blockquote>
<p><a href="https://ridl.unhcr.org/dataset/%60__name_of_dataset__" class="external-link uri">https://ridl.unhcr.org/dataset/`__name_of_dataset__</a>`</p>
</blockquote>
<p>Data files, e.g an Excel file, as well as any supporting documentation are called <code>resource</code> and are shared as either <code>data</code> or <code>attachment</code> within a specific <code>dataset</code> page.</p>
</div>
<div class="section level3">
<h3 id="resource">
<code>Resource</code><a class="anchor" aria-label="anchor" href="#resource"></a>
</h3>
<p>A <code>resource</code> is a file shared in <code>dataset</code> page. Depending on the type ( <code>data</code> or <code>attachment</code> ) , it comes with specific minimum <code>metadata</code> that complement the metata from the project itself.</p>
<p>Resources URL are typically formatted as:</p>
<blockquote>
<p><a href="https://ridl.unhcr.org/dataset/%60__name_of_dataset__%60/resource/%60__id_of_the_resource__" class="external-link uri">https://ridl.unhcr.org/dataset/`__name_of_dataset__`/resource/`__id_of_the_resource__</a>`</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="how-to">How To<a class="anchor" aria-label="anchor" href="#how-to"></a>
</h2>
<p>As a UNHCR staff, you should have access to a series of containers based on where you are working. Within each container, if you have editor or admin right, you can create a dataset.</p>
<div class="section level3">
<h3 id="use-case-1-create-a-new-dataset">Use case 1: create a new dataset<a class="anchor" aria-label="anchor" href="#use-case-1-create-a-new-dataset"></a>
</h3>
<p>To create a dataset, you need first to document the dataset metadata, including the reference to the container where you would like the new dataset to be created. Once the dataset is created, you can add as many resources as required (either <code>data</code> or <code>attachment</code>).</p>
<pre class="{r}"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://edouard-legoupil.github.io/riddle/" class="external-link">riddle</a></span><span class="op">)</span></span>
<span><span class="co">## let use UAT </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>USE_UAT<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## First we create the dataset metadata</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dataset_metadata.html">dataset_metadata</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Motor Trend Car Road Tests"</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">"testing-riddle"</span>,</span>
<span>                      notes <span class="op">=</span> <span class="st">"The data was extracted from the 1974 Motor Trend </span></span>
<span><span class="st">                      US magazine, and comprises fuel consumption and 10 aspects</span></span>
<span><span class="st">                      of automobile design and performance for 32 automobiles </span></span>
<span><span class="st">                      (1973–74 models)."</span>,</span>
<span>                      owner_org <span class="op">=</span> <span class="st">"americas"</span>, <span class="co">## becarefull this is the </span></span>
<span>                                             <span class="co">##canonincal name of the container</span></span>
<span>                      visibility <span class="op">=</span> <span class="st">"public"</span>,</span>
<span>                      external_access_level <span class="op">=</span> <span class="st">"open_access"</span>,</span>
<span>                      data_collector <span class="op">=</span> <span class="st">"Motor Trend"</span>,</span>
<span>                      keywords <span class="op">=</span> <span class="va">keywords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Environment"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                      unit_of_measurement <span class="op">=</span> <span class="st">"car"</span>,</span>
<span>                      data_collection_technique <span class="op">=</span> <span class="st">"oth"</span>,</span>
<span>                      archived <span class="op">=</span> <span class="st">"False"</span><span class="op">)</span></span>
<span>                      </span>
<span><span class="co">## For the above to work - you need to make sure you have at least editor access</span></span>
<span><span class="co"># to the corresponding container - i.e. owner_org = "americas"</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dataset.html">dataset_create</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The return value is a representation of the dataset we just created in</span></span>
<span><span class="co"># RIDL that you could inspect like any other R object.</span></span>
<span><span class="va">p</span> </span></code></pre>
</div>
<div class="section level3">
<h3 id="use-case-2-replace-data-file-within-dataset">Use case 2: replace data file within dataset<a class="anchor" aria-label="anchor" href="#use-case-2-replace-data-file-within-dataset"></a>
</h3>
<p>Ideally, data resources from kobotoolbox should be added using the API connection as described in <a href="https://im.unhcr.org/ridl/#Link_kobo_ridl" class="external-link">Part 4 of the documentation</a>.</p>
<p>Though, there might be specific cases where you are building an operational dataset, scrapping an official data source from the web or within a PDF and want to add this on a regular basis as a new <code>data</code> resource within an existing dataset. You can check a practical example of such use case here:<a href="https://github.com/unhcr-americas/darien_gap_human_mobility/tree/main/R" class="external-link">darien_gap_human_mobility</a></p>
<p>Below is simple example using the <code>mtcars</code> dataset as an example.</p>
<pre class="{r}"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://edouard-legoupil.github.io/riddle/" class="external-link">riddle</a></span><span class="op">)</span></span>
<span><span class="co">## let's get again the details of the dataset we want to add the resource in </span></span>
<span><span class="co"># based on a search...</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/search.html">dataset_search</a></span><span class="op">(</span><span class="st">"testing-riddle"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## and now can search for it - checking it is correctly there... </span></span>
<span><span class="fu"><a href="reference/search.html">resource_search</a></span><span class="op">(</span><span class="st">"name:mtcars"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/resource_metadata.html">resource_metadata</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>                       url <span class="op">=</span> <span class="st">"mtcars.csv"</span>,</span>
<span>                       name <span class="op">=</span> <span class="st">"mtcars.csv"</span>,</span>
<span>                       format <span class="op">=</span> <span class="st">"csv"</span>,</span>
<span>                       file_type <span class="op">=</span> <span class="st">"microdata"</span>,</span>
<span>                       date_range_start <span class="op">=</span> <span class="st">"1973-01-01"</span>,</span>
<span>                       date_range_end <span class="op">=</span> <span class="st">"1973-12-31"</span>,</span>
<span>                       version <span class="op">=</span> <span class="st">"1"</span>,</span>
<span>                       visibility <span class="op">=</span> <span class="st">"public"</span>,</span>
<span>                       process_status <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>                       identifiability <span class="op">=</span> <span class="st">"anonymized_public"</span><span class="op">)</span></span>
<span><span class="co">## let's get again the details of the dataset we want to add the resource in..</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/resource.html">resource_update</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">id</span>, <span class="va">m</span>, uat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Like before, the return value is a tibble representation of the</span></span>
<span><span class="co"># resource.</span></span>
<span><span class="va">r</span></span>
<span></span></code></pre>
</div>
<div class="section level3">
<h3 id="use-case-3-add-a-new-attachment-with-your-reproducible-analysis-code">Use case 3: Add a new attachment with your reproducible analysis code<a class="anchor" aria-label="anchor" href="#use-case-3-add-a-new-attachment-with-your-reproducible-analysis-code"></a>
</h3>
<p>You want to add your own initial data exploration, data interpretation presentation and/or data story telling report as a new <code>attachement</code> resource within a dataset.</p>
<p>You can check a practical example of such use case here:<a href="https://edouard-legoupil.github.io/kobocruncher/" class="external-link">kobocruncher</a></p>
<pre class="{r}"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://edouard-legoupil.github.io/riddle/" class="external-link">riddle</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># And once we’re done experimenting with the API, we should take down our</span></span>
<span><span class="co"># toy dataset since we don’t really need it on RIDL.</span></span>
<span><span class="fu"><a href="reference/dataset.html">dataset_delete</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="use-case-4-data-landscape-report">Use case 4: Data Landscape Report<a class="anchor" aria-label="anchor" href="#use-case-4-data-landscape-report"></a>
</h3>
<p>The package includes a parameterized notebook template (with parameter including region and year) to assess data landscape.</p>
<p>Based on metadata, the reports looks at what type of data are available per country and provide a ways to perform data gap analysis</p>
<ul>
<li>How many dataset we have per country?<br>
</li>
<li>Data set collected at household level<br>
</li>
<li>Data set collected at Community level<br>
</li>
<li>Data by Access type<br>
</li>
<li>Data over time<br>
</li>
<li>Data Collection Mode<br>
</li>
<li>Data by Topic<br>
</li>
<li>Data linked to Kobo in RIDL<br>
</li>
<li>By Sampling type</li>
</ul>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/edouard-legoupil/riddle/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/edouard-legoupil/riddle/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing riddle</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Hisham Galal <br><small class="roles"> Author, maintainer </small>  </li>
<li>Edouard Legoupil <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Hisham Galal, Edouard Legoupil.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
